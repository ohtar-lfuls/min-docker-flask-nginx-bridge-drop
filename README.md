# BridgeDrop

AirDropが使えない環境でも、AirDropのように直感的にファイルを送れるファイル転送ツール。

**開発開始**: 2026/01/04(土)

## コンセプト

- **全OS対応**: Windows、Mac、Linux、iOS、Android - ブラウザがあれば動作
- **低スペックでも動作**: GPUは不要、メモリ消費も最小限
- **PWA対応**: ホーム画面に追加すればネイティブアプリのように使用可能
- **プライバシー保護**: ファイルは10分後に自動削除

## 必要環境

- Docker Desktop（起動していること）
- Docker Compose

## セットアップ

### 1. Docker Desktopを起動

Docker Desktopを起動し、タスクトレイにクジラアイコンが表示されるまで待ちます（1〜2分）。

### 2. プロジェクトディレクトリに移動

```bash
cd min-docker-flask-nginx-bridge-drop
```

### 3. コンテナをビルド

```bash
docker compose build
```

### 4. コンテナを起動

```bash
docker compose up
```

バックグラウンドで起動する場合：

```bash
docker compose up -d
```

### 5. ブラウザでアクセス

```
http://localhost:8080
```

### 6. サーバーを停止

フォアグラウンドで起動した場合：`Ctrl + C`

バックグラウンドで起動した場合：

```bash
docker compose down
```

---

## クイックスタート（ビルド＆起動を一括実行）

```bash
docker compose up --build
```

---

## サーバーPCのIPアドレスを確認

他の端末からアクセスする場合、サーバーPCのIPアドレスが必要です。

**Windows:**

```bash
ipconfig
```

**Mac:**

```bash
ifconfig
```

**Linux:**

```bash
ip addr
```

IPv4アドレスをメモ（例: `192.168.1.100`）

---

## 使い方

### ファイルを送信する（送信側）

1. **ブラウザでBridgeDropを開く**

   **重要: サーバーPC（Dockerを起動している端末）から送信する場合も、IPアドレスでアクセスしてください。**

   ```
   http://[サーバーIP]:8080
   ```

   例: `http://192.168.1.100:8080`

   > **なぜlocalhostではダメ？**
   >
   > `localhost`でアクセスすると、QRコードのURLも`localhost`になります。
   > 他の端末は`localhost`にアクセスできないため、QRコードが使えません。
   > IPアドレスでアクセスすれば、QRコードにもIPアドレスが含まれ、
   > 他の端末からスキャンしてアクセスできます。

2. **ファイルを選択**
   - 「タップしてファイルを選択」をタップ
   - または、ファイルをドラッグ&ドロップ

3. **アップロード完了を待つ**
   - 進捗バーが100%になるまで待機

4. **QRコードを受信者に見せる**
   - 画面に表示されたQRコードをそのまま見せる
   - または「URLをコピー」してメッセージで送信

### ファイルを受信する（受信側）

#### 方法A: QRコードをスキャン（推奨）

1. スマホのカメラアプリまたはQRコードリーダーを起動
2. 送信者の画面に表示されたQRコードをスキャン
3. 表示されたURLをタップ
4. ファイルが自動的にダウンロードされる

#### 方法B: URLを直接開く

1. 送信者から共有されたURLをブラウザで開く
2. ファイルが自動的にダウンロードされる

---

## PWAとしてインストール（スマホ）

ホーム画面に追加すると、アプリのように使えます。

### iPhone (Safari)

1. BridgeDropをSafariで開く
2. 画面下の共有ボタン（□↑）をタップ
3. 「ホーム画面に追加」をタップ
4. 「追加」をタップ

### Android (Chrome)

1. BridgeDropをChromeで開く
2. 右上のメニュー（⋮）をタップ
3. 「ホーム画面に追加」または「アプリをインストール」をタップ
4. 「追加」をタップ

---

## 注意事項

- **同じネットワーク内でのみ使用可能**: 送信側・受信側は同じWi-Fiに接続している必要があります
- **ファイルは10分後に自動削除**: プライバシー保護のため、アップロードしたファイルは10分後に自動的に削除されます
- **最大ファイルサイズ**: 500MBまで対応

---

## 仕組み

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   送信側        │     │   サーバー       │     │   受信側        │
│  (スマホA)      │     │  (Docker)       │     │  (PC/スマホB)   │
└────────┬────────┘     └────────┬────────┘     └────────┬────────┘
         │                       │                       │
         │  1. ファイルアップロード │                       │
         │ ──────────────────────>│                       │
         │                       │                       │
         │  2. QRコード表示       │                       │
         │ <──────────────────────│                       │
         │                       │                       │
         │  3. QRコードを見せる    │                       │
         │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─>│
         │                       │                       │
         │                       │  4. QRスキャン→アクセス │
         │                       │ <─────────────────────│
         │                       │                       │
         │                       │  5. ファイル送信       │
         │                       │ ─────────────────────>│
         │                       │                       │
         │                       │  (10分後自動削除)      │
         │                       │ ─────X                │
```

---

## トラブルシューティング

### Docker Desktopが起動していない

エラー例：
```
open //./pipe/dockerDesktopLinuxEngine: The system cannot find the file specified.
```

**解決方法:**

1. Docker Desktopを起動
2. タスクトレイにクジラアイコンが表示されるまで待つ
3. 再度コマンドを実行

### 他の端末からアクセスできない

1. ファイアウォールでポート8080が許可されているか確認
2. サーバーPCのIPアドレスが正しいか確認
3. 送信側・受信側が同じネットワークに接続されているか確認

### QRコードのURLがlocalhostになる

**原因:** `localhost`でBridgeDropにアクセスしているため

**解決方法:** IPアドレスでアクセスする

```
http://[サーバーIP]:8080
```

### QRコードが読み取れない

- 画面の明るさを上げる
- カメラを近づける/離す
- 「URLをコピー」でURLを直接共有する

### ファイルがダウンロードできない

- 10分以上経過していないか確認（期限切れの可能性）
- URLが正しいか確認
- サーバーが起動しているか確認

---

## API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| `/api/upload` | POST | ファイルをアップロード |
| `/api/download/<file_id>/<filename>` | GET | ファイルをダウンロード |
| `/api/qrcode?url=<url>` | GET | QRコード画像を生成 |

---

## 技術スタック

- **バックエンド**: Flask + Flask-RESTful + uWSGI
- **フロントエンド**: HTML/CSS/JavaScript (Vanilla)
- **Webサーバー**: Nginx
- **コンテナ**: Docker + Docker Compose
- **QRコード**: qrcode + Pillow

---

## ベースプロジェクト

[NULL62d3/min-docker-flask-nginx](https://github.com/NULL62d3/min-docker-flask-nginx)

## システム構成

Nginx + Flask (uWSGI) 構成

![System Configuration Diagram](doc/System_configuration_diagram.png)
